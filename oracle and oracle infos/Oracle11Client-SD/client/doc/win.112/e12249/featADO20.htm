<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
<meta http-equiv="Content-Language" content="en" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta name="robots" content="all" scheme="http://www.robotstxt.org/" />
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.1 Build 026" />
<meta name="Date" content="2010-01-27T18:53:55Z" />
<meta name="doctitle" content="Oracle&reg; Data Provider for .NET Developer's Guide 11g Release 2 (11.2)" />
<meta name="partno" content="E12249-01" />
<meta name="docid" content="ODPNT" />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />
<link rel="Stylesheet" href="../../dcommon/css/blafdoc.css" title="Default" type="text/css" />
<script type="text/javascript" src="../../dcommon/js/doccd.js">
</script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="featConnecting.htm" title="Previous" type="text/html" />
<link rel="Next" href="featOraCommand.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e12249.pdf" title="PDF version" type="application/pdf" />
<title>ADO.NET 2.0 Features</title>
</head>
<body>
<div class="header">
<div class="zz-skip-header"><a name="top" id="top" href="#BEGIN">Skip Headers</a></div>
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td align="left" valign="top"><b>Oracle&reg; Data Provider for .NET Developer's Guide<br />
11<i>g</i> Release 2 (11.2)</b><br />
Part Number E12249-01</td>
<td valign="bottom" align="right">
<table class="icons oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="245">
<tr>
<td align="center" valign="top"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td align="center" valign="top"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td align="center" valign="top"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td align="center" valign="top"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td align="center" valign="top"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
<hr />
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td align="left" valign="top">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="98">
<tr>
<td align="center" valign="top"><a href="featConnecting.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td align="center" valign="top"><a href="featOraCommand.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td align="right" valign="top" style="font-size: 90%"><a href="../e12249.pdf">View PDF</a></td>
</tr>
</table>
<a name="BEGIN" id="BEGIN"></a></div>
<div class="IND"><!-- End Header --><a id="CJAECJFF" name="CJAECJFF"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h1 class="sect1">ADO.NET 2.0 Features<a id="sthref226" name="sthref226"></a><a id="sthref227" name="sthref227"></a><a id="sthref228" name="sthref228"></a><a id="sthref229" name="sthref229"></a><a id="sthref230" name="sthref230"></a><a id="sthref231" name="sthref231"></a><a id="sthref232" name="sthref232"></a><a id="sthref233" name="sthref233"></a><a id="sthref234" name="sthref234"></a> <a id="sthref235" name="sthref235"></a><a id="sthref236" name="sthref236"></a><a id="sthref237" name="sthref237"></a></h1>
<p>Oracle Data Provider for .NET 10.2.0.2 or later supports Microsoft ADO.NET 2.0 APIs.</p>
<p>This section contains the following topics:</p>
<ul>
<li>
<p><a href="#BABDGGGE">About ADO.NET 2.0</a></p>
</li>
<li>
<p><a href="#BABCGJGA">Base Classes and Provider Factory Classes</a></p>
</li>
<li>
<p><a href="#BABDCGGC">Connection String Builder</a></p>
</li>
<li>
<p><a href="#BABBAEIC">Data Source Enumerator</a></p>
</li>
<li>
<p><a href="#CJADJBHA">Support for Code Access Security</a></p>
</li>
<li>
<p><a href="#CJADIFGJ">Support for Schema Discovery</a></p>
</li>
<li>
<p><a href="#CJAEDJII">System.Transactions and Promotable Transactions</a></p>
</li>
<li>
<p><a href="#CJAGBFGI">Batch Processing Support</a></p>
</li>
<li>
<p><a href="#BABDEJDF">ADO.NET 2.0 Only Classes and Class Members</a></p>
</li>
<li>
<p><a href="#BABBFCJJ">Bulk Copy Support</a></p>
</li>
</ul>
<a id="BABDGGGE" name="BABDGGGE"></a>
<div class="sect2">
<h2 class="sect2">About ADO.NET 2.0</h2>
<p>ADO.NET 2.0 is a Microsoft specification that provides data access features designed to work together for provider independence, increased component reuse, and application convertibility. Additional features make it easier for an application to dynamically discover information about the data source, schema, and provider.</p>
<div class="infoboxnote">
<p class="notep1">Note:</p>
Using ODP.NET with Microsoft ADO.NET 2.0 requires ADO.NET 2.0- compliant ODP.NET.</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<p>ADO.NET in the MSDN Library</p>
</div>
</div>
<!-- class="sect2" -->
<a id="BABCGJGA" name="BABCGJGA"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Base Classes and Provider Factory Classes<a id="sthref238" name="sthref238"></a> <a id="sthref239" name="sthref239"></a><a id="sthref240" name="sthref240"></a><a id="sthref241" name="sthref241"></a></h2>
<p>With ADO.NET 2.0, data classes derive from the base classes defined in the <code>System.Data.Common</code> namespace. Developers can create provider-specific instances of these base classes using provider factory classes.</p>
<p>Provider factory classes allow generic data access code to access multiple data sources with a minimum of data source-specific code. This reduces much of the conditional logic currently used by applications accessing multiple data sources.</p>
<p>Using Oracle Data Provider for .NET, the <code>OracleClientFactory</code> class can be returned and instantiated, enabling an application to create instances of the following ODP.NET classes that inherit from the base classes:</p>
<div class="tblformal"><a id="sthref242" name="sthref242"></a><a id="sthref243" name="sthref243"></a>
<p class="titleintable">Table 3-3 ODP.NET Classes that Inherit from ADO.NET 2.0 Base Classes</p>
<table class="Formal" title="ODP.NET Classes that Inherit from ADO.NET 2.0 Base Classes" summary="Rows are Oracle classes. First column is name, second column is ADO.NET 2..0 Base class that it is inherited from" dir="ltr" border="1" width="100%" frame="hsides" rules="groups" cellpadding="3" cellspacing="0">
<col width="46%" />
<col width="*" />
<thead>
<tr align="left" valign="top">
<th align="left" valign="bottom" id="r1c1-t26">ODP.NET Classes</th>
<th align="left" valign="bottom" id="r1c2-t26">Inherited from ADO.NET 2.0 Base Class</th>
</tr>
</thead>
<tbody>
<tr align="left" valign="top">
<td align="left" id="r2c1-t26" headers="r1c1-t26">
<p><code>OracleClientFactory</code></p>
</td>
<td align="left" headers="r2c1-t26 r1c2-t26">
<p><code>DbProviderFactory</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r3c1-t26" headers="r1c1-t26">
<p><code>OracleCommand</code></p>
</td>
<td align="left" headers="r3c1-t26 r1c2-t26">
<p><code>DbCommand</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r4c1-t26" headers="r1c1-t26">
<p><code>OracleCommandBuilder</code></p>
</td>
<td align="left" headers="r4c1-t26 r1c2-t26">
<p><code>DbCommandBuilder</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r5c1-t26" headers="r1c1-t26">
<p><code>OracleConnection</code></p>
</td>
<td align="left" headers="r5c1-t26 r1c2-t26">
<p><code>DbConnection</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r6c1-t26" headers="r1c1-t26">
<p><code>OracleConnectionStringBuilder</code></p>
</td>
<td align="left" headers="r6c1-t26 r1c2-t26">
<p><code>DbConnectionStringBuilder</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r7c1-t26" headers="r1c1-t26">
<p><code>OracleDataAdapter</code></p>
</td>
<td align="left" headers="r7c1-t26 r1c2-t26">
<p><code>DbDataAdapter</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r8c1-t26" headers="r1c1-t26">
<p><code>OracleDataReader</code></p>
</td>
<td align="left" headers="r8c1-t26 r1c2-t26">
<p><code>DbDataReader</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r9c1-t26" headers="r1c1-t26">
<p><code>OracleDataSourceEnumerator</code></p>
</td>
<td align="left" headers="r9c1-t26 r1c2-t26">
<p><code>DbDataSourceEnumerator</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r10c1-t26" headers="r1c1-t26">
<p><code>OracleException</code></p>
</td>
<td align="left" headers="r10c1-t26 r1c2-t26">
<p><code>DbException</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r11c1-t26" headers="r1c1-t26">
<p><code>OracleParameter</code></p>
</td>
<td align="left" headers="r11c1-t26 r1c2-t26">
<p><code>DbParameter</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r12c1-t26" headers="r1c1-t26">
<p><code>OracleParameterCollection</code></p>
</td>
<td align="left" headers="r12c1-t26 r1c2-t26">
<p><code>DbParameterCollection</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r13c1-t26" headers="r1c1-t26">
<p><code>OracleTransaction</code></p>
</td>
<td align="left" headers="r13c1-t26 r1c2-t26">
<p><code>DbTransaction</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<p>In general, applications still require Oracle-specific connection strings, SQL or stored procedure calls, and declare that a factory from <code>Oracle.DataAccess.Client</code> is used.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="OracleClientFactoryClass.htm#CHDEAFAB">"OracleClientFactory Class"</a></div>
</div>
<!-- class="sect2" -->
<a id="BABDCGGC" name="BABDCGGC"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Connection String Builder<a id="sthref244" name="sthref244"></a><a id="sthref245" name="sthref245"></a></h2>
<p>The <code>OracleConnectionStringBuilder</code> class makes creating connection strings less error-prone and easier to manage.</p>
<p>Using this class, developers can employ a configuration file to provide the connection string and/or dynamically set the values though the key/value pairs. One example of a configuration file entry follows:</p>
<pre xml:space="preserve" class="oac_no_warn">&lt;configuration&gt;
   &lt;connectionStrings&gt; 
&lt;add name="Publications" providerName="Oracle.DataAccess.Client" 
           connectionString="User Id=scott;Password=tiger;Data Source=inst1" /&gt;
   &lt;/connectionStrings&gt; 
&lt;/configuration&gt;
</pre>
<p>Connection string information can be retrieved by specifying the connection string name, in this example, <code>Publications</code>. Then, based on the <code>providerName</code>, the appropriate factory for that provider can be obtained. This makes managing and modifying the connection string easier. In addition, this provides better security against string injection into a connection string.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="OracleConnectionStringBuilderClass.htm#CHDJJHGF">"OracleConnectionStringBuilder Class"</a></div>
</div>
<!-- class="sect2" -->
<a id="BABBAEIC" name="BABBAEIC"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Data Source Enumerator<a id="sthref246" name="sthref246"></a><a id="sthref247" name="sthref247"></a></h2>
<p>The data source enumerator enables the application to generically obtain a collection of the Oracle data sources that the application can connect to.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="OracleDataSourceEnumeratorClass.htm#CHDEHJCE">"OracleDataSourceEnumerator Class"</a></div>
</div>
<!-- class="sect2" -->
<a id="CJADJBHA" name="CJADJBHA"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Support for Code Access Security</h2>
<p>ODP.NET implements code access security through the <code>OraclePermission</code> class. This ensures that application code trying to access the database has the requisite permission to do so.</p>
<p>When a .NET assembly tries to access Oracle Database through ODP.NET, ODP.NET demands <code>OraclePermission</code>. The .NET runtime security system checks to see whether the calling assembly, and all other assemblies in the call stack, have <code>OraclePermission</code> granted to them. If all assemblies in the call stack have <code>OraclePermission</code> granted to them, then the calling assembly can access the database. If any one of the assemblies in the call stack does not have <code>OraclePermission</code> granted to it, then a security exception is thrown.</p>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref248" name="sthref248"></a>
<h3 class="sect3">Configuring OraclePermission</h3>
<p>The <code>DemandOraclePermission</code> configuration attribute is used to enable or disable <code>OraclePermission</code> demand for an ODP.NET API. The <code>DemandOraclePermission</code> value can be specified in the Windows registry or an individual application configuration file.</p>
<p>The following Windows registry key is used to configure the <code>DemandOraclePermission</code> configuration attribute:</p>
<pre xml:space="preserve" class="oac_no_warn">HKEY_LOCAL_MACHINE\SOFTWARE\ORACLE\ODP.NET\<span class="italic">Assembly_Version</span>\DemandOraclePermission
</pre>
<p>Here <code><span class="codeinlineitalic">Assembly_Version</span></code> is the full assembly version number of <code>Oracle.DataAccess.dll.</code> The <code>DemandOraclePermission</code> key is of type <code>REG_SZ</code>. It can be set to either <code>1</code> (enabled) or <code>0</code> (disabled).</p>
<p>You can also enable <code>OraclePermission</code> demand for an individual application using its application configuration file. The following example enables the <code>DemandOraclePermission</code> property in an application configuration file:</p>
<pre xml:space="preserve" class="oac_no_warn">&lt;configuration&gt;
  &lt;oracle.dataaccess.client&gt;
    &lt;settings&gt;
      &lt;add name="DemandOraclePermission" value="1"/&gt;
    &lt;/settings&gt;
  &lt;/oracle.dataaccess.client&gt;
&lt;/configuration&gt;
</pre>
<p>An application or assembly can successfully access the database if <code>OraclePermission</code> has been added to the permission set associated with the assembly's code group. A system administrator can modify the appropriate permission set manually or by using the Microsoft .NET configuration tool (<code>Mscorcfg.msc</code>).</p>
<p>Administrators may also use an appropriate .NET Framework Tool, such as the Code Access Security Policy Tool (<code>Caspol.exe)</code>, to modify security policy at the machine, user, and enterprise levels for including <code>OraclePermission</code>.</p>
<p><code>OracleConnection</code> makes security demands using the <code>OraclePermission</code> object when <code>OraclePermission</code> demand has been enabled using <code>DemandOraclePermission</code> configuration attribute. Application developers should make sure that their code has sufficient permission before using <code>OracleConnection</code>.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="OraclePermissionClass.htm#CHDIGAIH">"OraclePermission Class"</a></p>
</li>
<li>
<p><a href="OraclePermissionAttributeClass.htm#CHDDJCGH">"OraclePermissionAttribute Class"</a></p>
</li>
</ul>
</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CJADIFGJ" name="CJADIFGJ"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Support for Schema Discovery<a id="sthref249" name="sthref249"></a><a id="sthref250" name="sthref250"></a></h2>
<p>ADO.NET 2.0 exposes five different types of metadata collections through the <code>OracleConnection.GetSchema</code> API. This permits application developers to customize metadata retrieval on an individual-application basis, for any Oracle data source. Thus, developers can build a generic set of code to manage metadata from multiple data sources.</p>
<p>The following types of metadata are exposed:</p>
<ul>
<li>
<p><code>MetaDataCollections</code></p>
<p>A list of metadata collections that is available from the data source, such as tables, columns, indexes, and stored procedures.</p>
</li>
<li>
<p><code>Restrictions</code></p>
<p>The restrictions that apply to each metadata collection, restricting the scope of the requested schema information.</p>
</li>
<li>
<p><code>DataSourceInformation</code></p>
<p>Information about the instance of the database that is currently being used, such as product name and version.</p>
</li>
<li>
<p><code>DataTypes</code></p>
<p>A set of information about each data type that the database supports.</p>
</li>
<li>
<p><code>ReservedWords</code></p>
<p>Reserved words for the Oracle query language.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="appendix.htm#BEHGIAGE">Appendix A, "Oracle Schema Collections"</a></div>
</li>
</ul>
<div class="sect3"><a id="sthref251" name="sthref251"></a>
<h3 class="sect3">User Customization of Metadata</h3>
<p>ODP.NET provides a comprehensive set of database schema information. Developers can extend or customize the metadata that is returned by the <code>GetSchema</code> method on an individual application basis.</p>
<p>To do this, developers must create a customized metadata file and provide the file name to the application as follows:</p>
<ol>
<li>
<p>Create a customized metadata file and put it in the <code>CONFIG</code> subdirectory where the .NET framework is installed. This is the directory that contains <code>machine.config</code> and the security configuration settings.</p>
<p>This file must contain the entire set of schema configuration information, not just the changes. Developers provide changes that modify the behavior of the schema retrieval to user-specific requirements. For instance, a developer can filter out internal database tables and just retrieve user-specific tables</p>
</li>
<li>
<p>Add an entry in the <code>app.config</code> file of the application, similar to the following, to provide the name of the metadata file, in name-value pair format.</p>
<pre xml:space="preserve" class="oac_no_warn">&lt;oracle.dataaccess.client&gt;
  &lt;settings&gt;
    &lt;add name="MetaDataXml" value="<span class="italic">CustomMetaData.xml</span>" /&gt;
  &lt;/settings&gt;
&lt;/oracle.dataaccess.client&gt;
</pre></li>
</ol>
<p>When the <code>GetSchema</code> method is called, ODP.NET checks the <code>app.config</code> file for the name of the customized metadata XML file. First, the <code>GetSchema</code> method searches for an entry in the file with a element named after the provider, in this example, <code>oracle.dataaccess.client</code>. In this XML element, the value that corresponds to the name <code>MetaDataXml</code> is the name of the customized XML file, in this example, <code><span class="codeinlineitalic">CustomMetaData.xml</span></code>.</p>
<p>If the metadata file is not in the correct directory, then the application loads the default metadata XML file, which is part of ODP.NET.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="OracleConnectionClass.htm#BABEFDDC">"GetSchema"</a></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CJAEDJII" name="CJAEDJII"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2"><a name="ODPNT0026" id="ODPNT0026"></a>System.Transactions and P<a id="sthref252" name="sthref252"></a><a id="sthref253" name="sthref253"></a><a id="sthref254" name="sthref254"></a><a id="sthref255" name="sthref255"></a><a id="sthref256" name="sthref256"></a><a id="sthref257" name="sthref257"></a>romotable Transactions</h2>
<p>ODP.NET for .NET Framework 2.0 supports <code>System.Transactions</code>. A local transaction is created for the first connection opened in the <code>System.Transactions</code> scope to Oracle Database 11<span class="italic">g</span> release 1 (11.1), or higher. When a second connection is opened, this transaction is automatically promoted to a distributed transaction. This functionality provides enhanced performance and scalability.</p>
<p>Connections created within a transaction context, such as <code>TransactionScope</code> or <code>ServicedComponent</code>, can be established to different versions of Oracle Database. However, in order to enable the local transaction to be promotable, the following must be true:</p>
<ul>
<li>
<p>The first connection in the transaction context must be established to an Oracle Database 11<span class="italic">g</span> release 1(11.1) instance or higher.</p>
</li>
<li>
<p>All connections opened within the transaction context must have the <code>"Promotable Transaction"</code> setting set to <code>"promotable"</code>. If you try to open a subsequent connection in the same transaction context with the <code>"Promotable Transaction"</code> setting set to <code>"local"</code>, an exception is thrown.</p>
</li>
<li>
<p>Promoting local transactions requires Oracle Services for Microsoft Transaction Server 11.1.0.7.20, or higher. If this requirement is not met, then a second connection request in the same transaction context throws an exception.</p>
</li>
</ul>
<p>Setting <code>"local"</code> as the value of <code>"PromotableTransaction"</code> in the registry, configuration file (machine/Web/application), or the <code>"Promotable Transaction"</code> connection string attribute allows only one connection to be opened in the transaction context, which is associated with a local transaction. Such local transactions cannot be promoted.</p>
<p>For applications connecting to a pre-Oracle Database 11<span class="italic">g</span> release 1 (11.1) instance, refer to <a href="#CJAEBFEB">"Local Transaction Support for Older Databases"</a>. This section describes how ODP.NET behavior can be controlled using the "Promotable Transaction" setting.</p>
<p>If applications use <code>System.Transactions</code>, it is required that the <code>"enlist"</code> connection string attribute is set to either <code>"true"</code> (default) or <code>"dynamic"</code>.</p>
<p>ODP.NET supports the following <code>System.Transactions</code> programming models for applications using distributed transactions.</p>
<ul>
<li>
<p><a href="#CJAJHAJJ">Implicit Transaction Enlistment Using TransactionScope</a></p>
</li>
<li>
<p><a href="#CJAECJCF">Explicit Transaction Enlistment Using CommittableTransaction</a>.</p>
</li>
<li>
<p><a href="#CJAEBFEB">Local Transaction Support for Older Databases</a></p>
</li>
</ul>
<a id="CJAJHAJJ" name="CJAJHAJJ"></a>
<div class="sect3">
<h3 class="sect3">Implicit Transaction Enlistment Using TransactionScope</h3>
<p>The <code>TransactionScope</code> class provides a mechanism to write transactional applications where the applications do not need to explicitly enlist in transactions.To accomplish this, the application uses the <code>TransactionScope</code> object to define the transactional code. Connections created within this transactional scope will enlist in a local transaction that can be promoted to a distributed transaction.</p>
<div class="infoboxnote">
<p class="notep1">Note:</p>
<p>If the first connection is opened to a pre-Oracle Database 11<span class="italic">g</span> release 1 (11.1) instance, then the connection enlists as a distributed transaction, by default.</p>
<p>You can optionally create the transaction as a local transaction by using the procedure described in <a href="#CJAEBFEB">"Local Transaction Support for Older Databases"</a>. However, these transactions cannot be promoted to distributed transactions.</p>
</div>
<p>Note that the application must call the <code>Complete</code> method on the <code>TransactionScope</code> object to commit the changes. Otherwise, the transaction is aborted by default.</p>
<pre xml:space="preserve" class="oac_no_warn">// C#
 
using System;
using Oracle.DataAccess.Client;
using System.Data;
using System.Data.Common;
using System.Transactions;
 
class psfTxnScope
{
  static void Main()
  {
    int retVal = 0;
    string providerName = "Oracle.DataAccess.Client";
    string constr = 
           @"User Id=scott;Password=tiger;Data Source=oracle;enlist=true";
 
    // Get the provider factory.
    DbProviderFactory factory = DbProviderFactories.GetFactory(providerName);
 
    try
    {
      // Create a TransactionScope object, (It will start an ambient
      // transaction automatically).
      using (TransactionScope scope = new TransactionScope())
      {
        // Create first connection object.
        using (DbConnection conn1 = factory.CreateConnection())
        {
          // Set connection string and open the connection. this connection 
          // will be automatically enlisted in a promotable local transaction.
          conn1.ConnectionString = constr;
          conn1.Open();
 
          // Create a command to execute the sql statement.
          DbCommand  cmd1 = factory.CreateCommand();
          cmd1.Connection = conn1;
          cmd1.CommandText = @"insert into emp (empno, ename, job) values 
                                                     (1234, 'emp1', 'dev1')";
 
          // Execute the SQL statement to insert one row in DB.
          retVal = cmd1.ExecuteNonQuery();
          Console.WriteLine("Rows to be affected by cmd1: {0}", retVal);
 
          // Close the connection and dispose the command object.
          conn1.Close();
          conn1.Dispose();
          cmd1.Dispose();
        }
 
        // The Complete method commits the transaction. If an exception has
        // been thrown or Complete is not called then the transaction is 
        // rolled back.
        scope.Complete();
      }
    }
    catch (Exception ex)
    {
      Console.WriteLine(ex.Message);
      Console.WriteLine(ex.StackTrace);
    }
  }
}
</pre></div>
<!-- class="sect3" -->
<a id="CJAECJCF" name="CJAECJCF"></a>
<div class="sect3">
<h3 class="sect3">Explicit Transaction Enlistment Using CommittableTransaction</h3>
<p>The instantiation of the <code>CommittableTransaction</code> object and the <code>EnlistTransaction</code> method provides an explicit way to create and enlist in a transaction. Note that the application must call <code>Commit</code> or <code>Rollback</code> on the <code>CommittableTransaction</code> object.</p>
<pre xml:space="preserve" class="oac_no_warn">// C#
 
using System;
using Oracle.DataAccess.Client;
using System.Data;
using System.Data.Common;
using System.Transactions;
 
class psfEnlistTransaction
{
  static void Main()
  {
    int retVal = 0;
    string providerName = "Oracle.DataAccess.Client";
    string constr = 
           @"User Id=scott;Password=tiger;Data Source=oracle;enlist=dynamic";
 
    // Get the provider factory.
    DbProviderFactory factory = DbProviderFactories.GetFactory(providerName);
 
    try
    {
      // Create a committable transaction object.
      CommittableTransaction cmtTx = new CommittableTransaction();
 
      // Open a connection to the DB.
      DbConnection conn1 = factory.CreateConnection();
      conn1.ConnectionString = constr;
      conn1.Open();
 
      // enlist the connection with the commitable transaction.
      conn1.EnlistTransaction(cmtTx);
 
      // Create a command to execute the sql statement.
      DbCommand cmd1 = factory.CreateCommand();
      cmd1.Connection = conn1;
      cmd1.CommandText = @"insert into emp (empno, ename, job) values 
                                                     (1234, 'emp1', 'dev1')";
 
      // Execute the SQL statement to insert one row in DB.
      retVal = cmd1.ExecuteNonQuery();
      Console.WriteLine("Rows to be affected by cmd1: {0}", retVal);
 
      // commit/rollback the transaction.
      cmtTx.Commit();   // commits the txn.
      //cmtTx.Rollback(); // rolls back the txn.
 
      // close and dispose the connection
      conn1.Close();
      conn1.Dispose();
      cmd1.Dispose();
    }
    catch (Exception ex)
    {
      Console.WriteLine(ex.Message);
      Console.WriteLine(ex.StackTrace);
    }
  }
}
</pre>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="OracleConnectionClass.htm#CHDBBHDE">"EnlistTransaction"</a></div>
</div>
<!-- class="sect3" -->
<a id="CJAEBFEB" name="CJAEBFEB"></a>
<div class="sect3"><!-- infolevel="all" infotype="General" -->
<h3 class="sect3">Local Transaction Support for Older Databases</h3>
<p>If the first connection in a <code>TransactionScope</code> is opened to a pre-Oracle Database 11<span class="italic">g</span> release 1 (11.1) instance, then the connection creates a distributed transaction, by default. You can optionally have the fist connection create a local transaction by using the procedure described in this section.</p>
<p>To create local transactions in a <code>System.Transactions</code> scope, either the <code>PromotableTransaction</code> setting in the registry, machine/Web/application configuration file, or the <code>"Promotable Transaction"</code> connection string attribute must be set to <code>"local"</code>.</p>
<p>If <code>"local"</code> is specified, the first connection opened in the <code>TransactionScope</code> uses a local transaction. If any subsequent connections are opened within the same <code>TransactionScope</code>, an exception is thrown. If there are connections already opened in the <code>TransactionScope</code>, and an <code>OracleConnection</code> with <code>"Promotable Transaction=local"</code> attempts to open within the same <code>TransactionScope</code>, an exception is thrown.</p>
<p>If <code>"promotable"</code> is specified, the first and all subsequent connections opened in the same <code>TransactionScope</code> enlist in the same distributed transaction.</p>
<p>If both the registry and the connection string attribute are used and set to different values, the connection string attribute overrides the registry entry value. If neither are set, <code>"promotable"</code> is used. This is the default value and is equivalent to previous versions of ODP.NET which only supported distributed transactions.</p>
<p>The registry entry for a particular version of ODP.NET applies for all applications using that version of ODP.NET.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="CJAGBFGI" name="CJAGBFGI"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Batch Processing Support<a id="sthref258" name="sthref258"></a><a id="sthref259" name="sthref259"></a><a id="sthref260" name="sthref260"></a></h2>
<p>The <code>OracleDataAdapter</code> <code>UpdateBatchSize</code> property enables batch processing when the <code>OracleDataAdapter.Update</code> method is called. <code>UpdateBatchSize</code> is a numeric property that indicates how many DataSet rows to update the Oracle database for each round-trip.</p>
<p>This enables the developer to reduce the number of round-trips to the database.</p>
<div class="infoboxnote">
<p class="notep1">Note:</p>
<a id="BABCIGDB" name="BABCIGDB"></a>Microsoft Hotfix Needed
<p>There is a known issue in Microsoft ADO.NET 2.0 that affects the <code>BatchUpdate</code> functionality.</p>
<p>To resolve this issue, both ODP.NET release 11.1 and a specific Microsoft hotfix must be installed on the same computer. The Microsoft hotfix is available for free download from the following site: <code><a href="http://support.microsoft.com/?id=916002">http://support.microsoft.com/?id=916002</a></code></p>
<p>Without this fix, the <code>BatchUpdate</code> feature does not provide the correct error description for the failed rows in the <code>DataSet</code>. All errors in a batch are either appended to the exception message, if <code>DbDataDataAdapter.ContinueUpdateOnError</code> is <code>false</code>, or appended to the <code>RowError</code> property of the last updated row of the <code>DataSet</code>.</p>
<p>ODP.NET has been enhanced to use this hotfix and to populate the correct error description to the <code>RowError</code> property of the individual failed rows in a batch.</p>
</div>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="OracleDataAdapterClass.htm#BABICEJH">"UpdateBatchSize"</a></div>
</div>
<!-- class="sect2" -->
<a id="BABDEJDF" name="BABDEJDF"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">ADO.NET 2.0 Only Classes and Class Members<a id="sthref261" name="sthref261"></a></h2>
<p>In addition to classes which are ADO.NET 2.0 only, other ODP.NET classes that inherit from the <code>System.Data.Common</code> namespace include methods and properties which require ADO.NET 2.0.</p>
<p>The following classes are ADO.NET 2.0 only:</p>
<ul>
<li>
<p><a href="OracleClientFactoryClass.htm#CHDEAFAB">OracleClientFactory Class</a></p>
</li>
<li>
<p><a href="OracleConnectionStringBuilderClass.htm#CHDJJHGF">OracleConnectionStringBuilder Class</a></p>
</li>
<li>
<p><a href="OracleDataSourceEnumeratorClass.htm#CHDEHJCE">OracleDataSourceEnumerator Class</a></p>
</li>
</ul>
<p>The following class members are ADO.NET 2.0 only:</p>
<ul>
<li>
<p><code>OracleCommandBuilder</code> Class Members</p>
<ul>
<li>
<p><a href="OracleCommandBuilderClass.htm#CHDDDIIJ">CatalogLocation</a> Property <span class="italic">(Not Supported)</span></p>
</li>
<li>
<p><a href="OracleCommandBuilderClass.htm#CHDEAGDI">CatalogSeparator</a> Property <span class="italic">(Not Supported)</span></p>
</li>
<li>
<p><a href="OracleCommandBuilderClass.htm#CHDIGDAG">ConflictOption</a> Property <span class="italic">(Not Supported)</span></p>
</li>
<li>
<p><a href="OracleCommandBuilderClass.htm#CHDCJCEE">QuotePrefix</a> Property</p>
</li>
<li>
<p><a href="OracleCommandBuilderClass.htm#CHDGAIGC">QuoteSuffix</a> Property</p>
</li>
<li>
<p><a href="OracleCommandBuilderClass.htm#CHDBDDDE">SchemaSeparator</a> Property</p>
</li>
<li>
<p><a href="OracleCommandBuilderClass.htm#CHDCICCA">QuoteIdentifier</a> Method</p>
</li>
<li>
<p><a href="OracleCommandBuilderClass.htm#CHDBEBHB">UnquoteIdentifier</a> Method</p>
</li>
</ul>
</li>
<li>
<p><code>OracleConnection</code> Class Members</p>
<ul>
<li>
<p><a href="OracleConnectionClass.htm#BABEFDDC">GetSchema</a> Methods</p>
</li>
</ul>
</li>
<li>
<p><code>OracleDataAdapter</code> Class Members</p>
<ul>
<li>
<p><a href="OracleDataAdapterClass.htm#BABICEJH">UpdateBatchSize</a> Property</p>
</li>
<li>
<p><a href="OracleDataAdapterClass.htm#CHDCFFDI">ReturnProviderSpecificTypes</a> Property</p>
</li>
</ul>
</li>
<li>
<p><code>OracleDataReader</code> Class Members</p>
<ul>
<li>
<p><a href="OracleDataReaderClass.htm#BABBCCEA">HiddenFieldCount</a> Property</p>
</li>
<li>
<p><a href="OracleDataReaderClass.htm#CHDIEIHA">VisibleFieldCount</a> Property</p>
</li>
<li>
<p><a href="OracleDataReaderClass.htm#BABBIDBH">GetProviderSpecificFieldType</a> Method</p>
</li>
<li>
<p><a href="OracleDataReaderClass.htm#BABCEBJA">GetProviderSpecificValue</a> Method</p>
</li>
<li>
<p><a href="OracleDataReaderClass.htm#BABIBJHF">GetProviderSpecificValues</a> Method</p>
</li>
</ul>
</li>
<li>
<p><code>OracleParameter</code> Class Members</p>
<ul>
<li>
<p><a href="OracleParameterClass.htm#BABHAAIC">SourceColumnNullMapping</a> Property</p>
</li>
<li>
<p><a href="OracleParameterClass.htm#CHDFHFHH">ResetDbType</a> Method</p>
</li>
<li>
<p><a href="OracleParameterClass.htm#CHDBIECF">ResetOracleDbType</a> Method</p>
</li>
</ul>
</li>
<li>
<p><code>OracleParameterCollection</code> Class Members</p>
<ul>
<li>
<p><a href="OracleParameterCollectionClass.htm#CHDGBGEA">AddRange</a> Method</p>
</li>
</ul>
</li>
</ul>
</div>
<!-- class="sect2" -->
<a id="BABBFCJJ" name="BABBFCJJ"></a>
<div class="sect2"><!-- infolevel="all" infotype="General" -->
<h2 class="sect2">Bulk Copy Support<a id="sthref262" name="sthref262"></a><a id="sthref263" name="sthref263"></a><a id="sthref264" name="sthref264"></a><a id="sthref265" name="sthref265"></a></h2>
<p>ODP.NET provides a Bulk Copy feature which enables applications to efficiently load large amounts of data from a table in one database to another table in the same or a different database.</p>
<p>The ODP.NET Bulk Copy feature uses a direct path load approach, which is similar to, but not the same as Oracle SQL*Loader. Using direct path load is faster than conventional loading (using conventional SQL <code>INSERT</code> statements). Conventional loading formats Oracle data blocks and writes the data blocks directly to the data files. Bulk Copy eliminates considerable processing overhead.</p>
<p>The ODP.NET Bulk Copy feature can load data into older Oracle databases.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="InstallSystemRequirements.htm#i1006191">"System Requirements"</a> to learn which versions of the Oracle Database ODP.NET interoperates with</div>
<p>The ODP.NET Bulk Copy feature is subject to the same basic restrictions and integrity constraints for direct path loads, as discussed in the next few sections.</p>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref266" name="sthref266"></a>
<h3 class="sect3">Data Types Supported by Bulk Copy</h3>
<p>The data types supported by Bulk Copy are:</p>
<ul>
<li>
<p><code>ORA_SB4</code></p>
</li>
<li>
<p><code>ORA_VARNUM</code></p>
</li>
<li>
<p><code>ORA_FLOAT</code></p>
</li>
<li>
<p><code>ORA_CHARN</code></p>
</li>
<li>
<p><code>ORA_RAW</code></p>
</li>
<li>
<p><code>ORA_BFLOAT</code></p>
</li>
<li>
<p><code>ORA_BDOUBLE</code></p>
</li>
<li>
<p><code>ORA_IBDOUBLE</code></p>
</li>
<li>
<p><code>ORA_IBFLOAT</code></p>
</li>
<li>
<p><code>ORA_DATE</code></p>
</li>
<li>
<p><code>ORA_TIMESTAMP</code></p>
</li>
<li>
<p><code>ORA_TIMESTAMP_TZ</code></p>
</li>
<li>
<p><code>ORA_TIMESTAMP_LTZ</code></p>
</li>
<li>
<p><code>ORA_INTERVAL_DS</code></p>
</li>
<li>
<p><code>ORA_INTERVAL_YM</code></p>
</li>
</ul>
<p>Bulk copy does not support overwrites.</p>
</div>
<!-- class="sect3" -->
<div class="sect3"><a id="sthref267" name="sthref267"></a>
<h3 class="sect3">Restrictions on Oracle Bulk Copy of a Single Partition</h3>
<ul>
<li>
<p>The table that contains the partition cannot have any global indexes defined on it.</p>
</li>
<li>
<p>The tables that the partition is a member of cannot have referential and check constraints enabled.</p>
</li>
<li>
<p>Enabled triggers are not allowed.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div class="sect3"><a id="sthref268" name="sthref268"></a>
<h3 class="sect3">Integrity Constraints Affecting Oracle Bulk Copy</h3>
<p>During a Oracle bulk copy, some integrity constraints are automatically enabled or disabled, as follows:</p>
<a id="sthref269" name="sthref269"></a>
<p class="subhead2">Enabled Constraints</p>
<p>During an Oracle bulk copy, the following constraints are automatically enabled by default:</p>
<ul>
<li>
<p><code>NOT</code> <code>NULL</code></p>
</li>
<li>
<p><code>UNIQUE</code></p>
</li>
<li>
<p><code>PRIMARY</code> <code>KEY</code> (unique-constraints on not-null columns)</p>
</li>
</ul>
<p><code>NOT</code> <code>NULL</code> constraints are checked at column array build time. Any row that violates the <code>NOT</code> <code>NULL</code> constraint is rejected.</p>
<p><code>UNIQUE</code> constraints are verified when indexes are rebuilt at the end of the load. The index is left in an Index Unusable state if it violates a <code>UNIQUE</code> constraint.</p>
<a id="sthref270" name="sthref270"></a>
<p class="subhead2">Disabled Constraints</p>
<p>During an Oracle bulk copy, the following constraints are automatically disabled by default:</p>
<ul>
<li>
<p><code>CHECK</code> constraints</p>
</li>
<li>
<p>Referential constraints (<code>FOREIGN</code> <code>KEY</code>)</p>
</li>
</ul>
<p>If the <code>EVALUATE</code> <code>CHECK_CONSTRAINTS</code> clause is specified, then <code>CHECK</code> constraints are not automatically disabled. The <code>CHECK</code> constraints are evaluated during a direct path load and any row that violates the <code>CHECK</code> constraint is rejected.</p>
</div>
<!-- class="sect3" -->
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref271" name="sthref271"></a>
<h3 class="sect3">Database Insert Triggers</h3>
<p>Table insert triggers are disabled when a direct path load begins. After the rows are loaded and indexes rebuilt, any triggers that were disabled are automatically reenabled. The log file lists all triggers that were disabled for the load. There should be no errors reenabling triggers.</p>
<p>Unlike integrity constraints, insert triggers are not reapplied to the whole table when they are enabled. As a result, insert triggers do not fire for any rows loaded on the direct path. When using the direct path, the application must ensure that any behavior associated with insert triggers is carried out for the new rows.</p>
</div>
<!-- class="sect3" -->
<div class="sect3"><a id="sthref272" name="sthref272"></a>
<h3 class="sect3">Field Defaults</h3>
<p>Default column specifications defined in the database are not available with direct path loading. Fields for which default values are desired must be specified with the <code>DEFAULTIF</code> clause. If a <code>DEFAULTIF</code> clause is not specified and the field is <code>NULL</code>, then a null value is inserted into the database.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="bulkcopy.htm#CHDDBFGJ">Chapter 17, "Oracle Data Provider for .NET Bulk Copy Classes"</a></div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<div class="footer">
<hr />
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<col width="33%" />
<col width="*" />
<col width="33%" />
<tr>
<td align="left">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="98">
<tr>
<td align="center" valign="top"><a href="featConnecting.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td align="center" valign="top"><a href="featOraCommand.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td style="font-size: 90%" align="center" class="copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td align="right">
<table class="icons oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="245">
<tr>
<td align="center" valign="top"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td align="center" valign="top"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td align="center" valign="top"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td align="center" valign="top"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td align="center" valign="top"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
</div>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
