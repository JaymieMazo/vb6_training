<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
<meta http-equiv="Content-Language" content="en" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta name="robots" content="all" scheme="http://www.robotstxt.org/" />
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.1 Build 026" />
<meta name="Date" content="2010-01-27T18:53:55Z" />
<meta name="doctitle" content="Oracle&reg; Data Provider for .NET Developer's Guide 11g Release 2 (11.2)" />
<meta name="partno" content="E12249-01" />
<meta name="docid" content="ODPNT" />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />
<link rel="Stylesheet" href="../../dcommon/css/blafdoc.css" title="Default" type="text/css" />
<script type="text/javascript" src="../../dcommon/js/doccd.js">
</script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="featUDTs.htm" title="Previous" type="text/html" />
<link rel="Next" href="featChange.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e12249.pdf" title="PDF version" type="application/pdf" />
<title>Oracle Streams Advanced Queuing Support</title>
</head>
<body>
<div class="header">
<div class="zz-skip-header"><a name="top" id="top" href="#BEGIN">Skip Headers</a></div>
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td align="left" valign="top"><b>Oracle&reg; Data Provider for .NET Developer's Guide<br />
11<i>g</i> Release 2 (11.2)</b><br />
Part Number E12249-01</td>
<td valign="bottom" align="right">
<table class="icons oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="245">
<tr>
<td align="center" valign="top"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td align="center" valign="top"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td align="center" valign="top"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td align="center" valign="top"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td align="center" valign="top"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
<hr />
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td align="left" valign="top">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="98">
<tr>
<td align="center" valign="top"><a href="featUDTs.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td align="center" valign="top"><a href="featChange.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td align="right" valign="top" style="font-size: 90%"><a href="../e12249.pdf">View PDF</a></td>
</tr>
</table>
<a name="BEGIN" id="BEGIN"></a></div>
<div class="IND"><!-- End Header --><a id="CJAGABAE" name="CJAGABAE"></a>
<div class="sect1"><!-- infolevel="all" infotype="General" -->
<h1 class="sect1">Oracle Streams Advanced Queuing Support</h1>
<p>Oracle Streams Advanced Queuing (AQ) provides database-integrated message queuing functionality. Oracle Streams AQ is built on top of Oracle Streams and leverages the functions of Oracle Database so that messages can be stored persistently, propagated between queues on different computers and databases, and transmitted using Oracle Net Services and HTTP(S).</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<span class="italic"><a class="olink ADQUE" href="http://www.oracle.com/pls/db102/lookup?id=ADQUE">Oracle Streams Advanced Queuing User's Guide and Reference</a></span></div>
<p>As Oracle Streams AQ is implemented in database tables, all operational benefits of high availability, scalability, and reliability are also applicable to queue data. Oracle Streams AQ supports standard database features such as recovery, restart, and security.</p>
<p>The following items discuss Oracle Streams AQ concepts:</p>
<ul>
<li>
<p>Queues and Queue Tables</p>
<p>Messages enqueued in a queue are stored in a queue table. A queue table must be created before creating a queue based on it. Use the <code>DBMS_AQADM</code> PL/SQL package or Oracle Developer Tools for Visual Studio to create and administer queue tables and queues.</p>
<p>Queues are represented by <code>OracleAQQueue</code> objects.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="OracleAQQueueClass.htm#CHDGCJBB">"OracleAQQueue Class"</a></div>
</li>
<li>
<p>Single-Consumer and Multiple-Consumer Queues</p>
<p>A single-consumer queue is created based on a single consumer queue table. Messages enqueued in a single-consumer queue can be dequeued by only a single consumer.</p>
<p>A multiple-consumer queue is based on a multiple-consumer queue table. This queue supports queue subscribers and message recipients.</p>
</li>
<li>
<p>Message Recipients</p>
<p>A message producer can submit a list of recipients when enqueuing a message. This allows for a unique set of recipients for each message in the queue. The recipient list associated with the message overrides the subscriber list, if any, associated with the queue. The recipients need not be in the subscriber list. However, recipients can be selected from among the subscribers.The <code>Recipients</code> property of an <code>OracleAQMessage</code> can be used to specify the recipients to a specific message in terms of <code>OracleAQAgent</code> objects.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="OracleAQMessageClass.htm#CHDIHJBA">"Recipients"</a></p>
</li>
<li>
<p><a href="OracleAQAgentClass.htm#CBADCHHG">"OracleAQAgent Class"</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Enqueue</p>
<p>Messages are enqueued when producer applications push the messages into a queue. This is accomplished by calling the <code>Enqueue</code> method on an <code>OracleAQQueue</code> object. Multiple messages can be enqueued using the <code>EnqueueArray</code> method.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="OracleAQQueueClass.htm#CHDJEAEA">"Enqueue"</a></p>
</li>
<li>
<p><a href="OracleAQQueueClass.htm#CHDJAGIH">"EnqueueArray"</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Dequeue</p>
<p>Messages are dequeued when consumer applications pull the messages from a queue. This is accomplished by calling the <code>Dequeue</code> method on an <code>OracleAQQueue</code> object. Multiple messages can be dequeued using the <code>DequeueArray</code> method.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="OracleAQQueueClass.htm#CHDHIHHD">"Dequeue"</a></p>
</li>
<li>
<p><a href="OracleAQQueueClass.htm#CHDBIBBF">"DequeueArray"</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Listen</p>
<p>Subscriber applications can use a <code>Listen</code> call to monitor multiple queues for subscriptions on different queues. This is a more scalable solution for cases where a subscriber application has subscribed to many queues and wishes to receive messages that arrive in any of the queues.This is accomplished by calling the <code>Listen</code> method of the <code>OracleAQQueue</code> class, passing the list of subscriptions in form of an array.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="OracleAQQueueClass.htm#CHDBFFIG">"Listen"</a></div>
</li>
<li>
<p>Notification</p>
<p>Subscriber applications can utilize the notification mechanism to get notifications about message availability in a queue. The applications can decide to skip or dequeue the message from the queue based on the information received.</p>
<p>A subscriber application must register for event notification on the queues from which it wants to receive notifications. This is represented by the <code>MessageAvailable</code> event on <code>OracleAQQueue</code>. The event is triggered when messages matching the subscriptions arrive.</p>
<p>Notifications can be registered as regular or grouping notifications. A time out value for these notifications can also be specified. Various notification options can be set using the <code>OracleAQQueue.Notification</code> property. Notifications set on an <code>OracleAQQueue</code> object gets cancelled automatically when the object gets disposed.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<ul>
<li>
<p><a href="OracleAQQueueClass.htm#CHDFICAF">"MessageAvailable Event"</a></p>
</li>
<li>
<p><a href="OracleAQQueueClass.htm#CHDHBDDJ">"Notification"</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Buffered Messaging</p>
<p>Buffered messaging was introduced in Oracle Streams AQ 10<span class="italic">g</span> Release 2 (10.2). In buffered messaging, messages reside in a shared memory area. This makes it faster than persistent messaging. The messages are written to disk only when the total memory consumption of buffered messages approaches the available shared memory limit. Buffered messaging is ideal for applications that do not require the reliability and transaction support of Oracle Streams AQ persistent messaging.</p>
<p>Buffered and persistent messages use the same single-consumer or multi-consumer queues, and the same administrative and operational interfaces. They are distinguished from each other by a delivery mode parameter. When an application enqueues a message to an Oracle Streams AQ queue, it sets the delivery mode parameter as well.</p>
<p>The delivery mode parameter can be set on <code>OracleAQMessage</code> by modifying the <code>DeliveryMode</code> property. Buffered messaging is supported in all queue tables created with compatibility 8.1 or higher.</p>
<div class="infoboxnotealso">
<p class="notep1">See Also:</p>
<a href="OracleAQMessageClass.htm#CHDCAGJG">"DeliveryMode"</a></div>
</li>
</ul>
<div class="sect2"><!-- infolevel="all" infotype="General" --><a id="sthref592" name="sthref592"></a>
<h2 class="sect2">Using ODP.NET for Advanced Queuing</h2>
<p>.NET applications can use ODP.NET to access all the operational features of AQ such as Enqueuing, Dequeuing, Listen, and Notification.</p>
<p><a href="#CJACAJHD">Table 3-25</a> maps the AQ features to their corresponding ODP.NET implementation.</p>
<div class="tblformal"><a id="sthref593" name="sthref593"></a><a id="CJACAJHD" name="CJACAJHD"></a>
<p class="titleintable">Table 3-25 Mapping AQ Features with their ODP.NET Implementation</p>
<table class="Formal" title="Mapping AQ Features with their ODP.NET Implementation" summary="Mapping AQ features with their ODP.NET implementation" dir="ltr" border="1" width="100%" frame="hsides" rules="groups" cellpadding="3" cellspacing="0">
<col width="31%" />
<col width="*" />
<thead>
<tr align="left" valign="top">
<th align="left" valign="bottom" id="r1c1-t107">Functionality</th>
<th align="left" valign="bottom" id="r1c2-t107">ODP.NET Implementation</th>
</tr>
</thead>
<tbody>
<tr align="left" valign="top">
<td align="left" id="r2c1-t107" headers="r1c1-t107">
<p>Create a Message</p>
</td>
<td align="left" headers="r2c1-t107 r1c2-t107">
<p>Create an <code>OracleAQMessage</code> object</p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r3c1-t107" headers="r1c1-t107">
<p>Enqueue a single message</p>
</td>
<td align="left" headers="r3c1-t107 r1c2-t107">
<p>Specify the message as <code>OracleAQMessage</code>, queue as <code>OracleAQQueue</code> and enqueue options on <code>OracleAQQueue</code>, call <code>OracleAQQueue.</code><a href="OracleAQQueueClass.htm#CHDJEAEA">Enqueue</a></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r4c1-t107" headers="r1c1-t107">
<p>Enqueue multiple messages</p>
</td>
<td align="left" headers="r4c1-t107 r1c2-t107">
<p>Specify the messages as an <code>OracleAQMessage</code> array in <code>OracleAQQueue.</code><a href="OracleAQQueueClass.htm#CHDJAGIH">EnqueueArray</a></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r5c1-t107" headers="r1c1-t107">
<p>Dequeue a single message</p>
</td>
<td align="left" headers="r5c1-t107 r1c2-t107">
<p>Specify dequeue options on <code>OracleAQQueue</code> and call <code>OracleAQQueue.</code><a href="OracleAQQueueClass.htm#CHDHIHHD">Dequeue</a></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r6c1-t107" headers="r1c1-t107">
<p>Dequeue multiple messages</p>
</td>
<td align="left" headers="r6c1-t107 r1c2-t107">
<p>Call <code>OracleAQQueue.</code><a href="OracleAQQueueClass.htm#CHDBIBBF">DequeueArray</a></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r7c1-t107" headers="r1c1-t107">
<p>Listen for messages on Queue(s)</p>
</td>
<td align="left" headers="r7c1-t107 r1c2-t107">
<p>Call <code>OracleAQQueue.</code><a href="OracleAQQueueClass.htm#CHDBFFIG">Listen</a>.To listen on multiple queues use static <a href="OracleAQQueueClass.htm#CHDJHFID">Listen</a> method of <code>OracleAQQueue</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r8c1-t107" headers="r1c1-t107">
<p>Message Notifications</p>
</td>
<td align="left" headers="r8c1-t107 r1c2-t107">
<p>Use <code>OracleAQQueue.</code><a href="OracleAQQueueClass.htm#CHDFICAF">MessageAvailable Event</a> along with the <code>NotificationConsumers</code> property</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblformal" -->
<div class="infoboxnote">
<p class="notep1">Note:</p>
AQ samples are provided in the <code><span class="codeinlineitalic">ORACLE_BASE</span></code><code>\</code><code><span class="codeinlineitalic">ORACLE_HOME</span></code><code>\ODP.NET\Samples</code> directory.</div>
<div class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref594" name="sthref594"></a>
<h3 class="sect3">Enqueuing and Dequeuing Example</h3>
<p>The following example demonstrates enqueuing and dequeuing messages using a single consumer queue. The first part of the example performs the requisite database setup for the database user, <code>SCOTT</code>. The second part of the example demonstrates enqueuing and dequeuing messages.</p>
<pre xml:space="preserve" class="oac_no_warn">-- Part I: Database setup required for this demo
 
------------------------------------------------------------------
-- SQL to grant appropriate privilege to database user, SCOTT
------------------------------------------------------------------
SQL&gt; ALTER USER SCOTT ACCOUNT UNLOCK IDENTIFIED BY Pwd4Sct;
User altered.
SQL&gt; GRANT ALL ON DBMS_AQADM TO scott;
 
------------------------------------------------------------------
-- PL/SQL to create queue-table and queue and start queue for SCOTT
------------------------------------------------------------------
BEGIN
  DBMS_AQADM.CREATE_QUEUE_TABLE(
    queue_table=&gt;'scott.test_q_tab', 
    queue_payload_type=&gt;'RAW', 
    multiple_consumers=&gt;FALSE);
 
  DBMS_AQADM.CREATE_QUEUE(
    queue_name=&gt;'scott.test_q', 
    queue_table=&gt;'scott.test_q_tab');
 
  DBMS_AQADM.START_QUEUE(queue_name=&gt;'scott.test_q');
END;
/
 
------------------------------------------------------------------
-- PL/SQL to stop queue and drop queue &amp; queue-table from SCOTT
------------------------------------------------------------------
BEGIN
  DBMS_AQADM.STOP_QUEUE('scott.test_q');
 
  DBMS_AQADM.DROP_QUEUE(
    queue_name =&gt; 'scott.test_q', 
    auto_commit =&gt; TRUE);
 
  DBMS_AQADM.DROP_QUEUE_TABLE(
    queue_table =&gt; 'scott.test_q_tab',
    force =&gt; FALSE, 
    auto_commit =&gt; TRUE);
END;
/
-- End of Part I, database setup.

//Part II: Enqueuing and dequeuing messages
//C#
using System;
using System.Text;
using Oracle.DataAccess.Client;
using Oracle.DataAccess.Types;
 
namespace ODPSample
{
  /// &lt;summary&gt;
  /// Demonstrates Enqueuing and Dequeuing raw message 
  /// using a single consumer queue
  /// &lt;/summary&gt;
  class EnqueueDequeue
  {
    static void Main(string[] args)
    {
      // Create connection
      string constr = "user id=scott;password=Pwd4Sct;data source=oracle";
      OracleConnection con = new OracleConnection(constr);
 
      // Create queue
      OracleAQQueue queue = new OracleAQQueue("scott.test_q", con);
 
      try
      {
        // Open connection
        con.Open();
 
        // Begin txn for enqueue
        OracleTransaction txn = con.BeginTransaction();
 
        // Set message type for the queue
        queue.MessageType = OracleAQMessageType.Raw;
 
        // Prepare message and RAW payload
        OracleAQMessage enqMsg = new OracleAQMessage();
        byte[] bytePayload = { 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 };
        enqMsg.Payload = bytePayload;
 
        // Prepare to Enqueue
        queue.EnqueueOptions.Visibility = OracleAQVisibilityMode.OnCommit;
 
        // Enqueue message
        queue.Enqueue(enqMsg);
 
        Console.WriteLine("Enqueued Message Payload      : "
          + ByteArrayToString(enqMsg.Payload as byte[]));
        Console.WriteLine("MessageId of Enqueued Message : "
          + ByteArrayToString(enqMsg.MessageId));
 
        // Enqueue txn commit
        txn.Commit();
 
        // Begin txn for Dequeue
        txn = con.BeginTransaction();
 
        // Prepare to Dequeue
        queue.DequeueOptions.Visibility = OracleAQVisibilityMode.OnCommit;
        queue.DequeueOptions.Wait = 10;
 
        // Dequeue message
        OracleAQMessage deqMsg = queue.Dequeue();
 
        Console.WriteLine("Dequeued Message Payload      : "
          + ByteArrayToString(deqMsg.Payload as byte[]));
        Console.WriteLine("MessageId of Dequeued Message : "
          + ByteArrayToString(deqMsg.MessageId));
 
        // Dequeue txn commit
        txn.Commit();
      }
      catch (Exception e)
      {
        Console.WriteLine("Error: {0}", e.Message);
      }
      finally
      {
        // Close/Dispose objects
        queue.Dispose();
        con.Close();
        con.Dispose();
      }
    }
 
    // Function to convert byte[] to string
    static private string ByteArrayToString(byte[] byteArray)
    {
      StringBuilder sb = new StringBuilder();
      for (int n = 0; n &lt; byteArray.Length; n++)
      {
        sb.Append((int.Parse(byteArray[n].ToString())).ToString("X"));
      }
      return sb.ToString();
    }
  }
}
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<div class="footer">
<hr />
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<col width="33%" />
<col width="*" />
<col width="33%" />
<tr>
<td align="left">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="98">
<tr>
<td align="center" valign="top"><a href="featUDTs.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td align="center" valign="top"><a href="featChange.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td style="font-size: 90%" align="center" class="copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2002, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td align="right">
<table class="icons oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="245">
<tr>
<td align="center" valign="top"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td align="center" valign="top"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td align="center" valign="top"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td align="center" valign="top"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td align="center" valign="top"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
</div>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
