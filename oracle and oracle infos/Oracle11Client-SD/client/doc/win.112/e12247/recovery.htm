<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
<meta http-equiv="Content-Language" content="en" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta name="robots" content="all" scheme="http://www.robotstxt.org/" />
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.1 Build 026" />
<meta name="Date" content="2010-01-21T17:30:13Z" />
<meta name="doctitle" content="Oracle&reg; Services for Microsoft Transaction Server Developer's Guide 11g Release 2 (11.2) for Microsoft Windows" />
<meta name="partno" content="E12247-01" />
<meta name="docid" content="NTMTS" />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />
<link rel="Stylesheet" href="../../dcommon/css/blafdoc.css" title="Default" type="text/css" />
<script type="text/javascript" src="../../dcommon/js/doccd.js">
</script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Glossary" href="glossary.htm" title="Glossary" type="text/html" />
<link rel="Prev" href="install.htm" title="Previous" type="text/html" />
<link rel="Next" href="prog.htm" title="Next" type="text/html" />
<link rel="alternate" href="../e12247.pdf" title="PDF version" type="application/pdf" />
<title>Managing Recovery Scenarios</title>
</head>
<body>
<div class="header">
<div class="zz-skip-header"><a name="top" id="top" href="#BEGIN">Skip Headers</a></div>
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td align="left" valign="top"><b>Oracle&reg; Services for Microsoft Transaction Server Developer's Guide<br />
11<i>g</i> Release 2 (11.2) for Microsoft Windows</b><br />
Part Number E12247-01</td>
<td valign="bottom" align="right">
<table class="icons oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="245">
<tr>
<td align="center" valign="top"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td align="center" valign="top"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td align="center" valign="top"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td align="center" valign="top"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td align="center" valign="top"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
<hr />
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td align="left" valign="top">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="98">
<tr>
<td align="center" valign="top"><a href="install.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td align="center" valign="top"><a href="prog.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td align="right" valign="top" style="font-size: 90%"><a href="../e12247.pdf">View PDF</a></td>
</tr>
</table>
<a name="BEGIN" id="BEGIN"></a></div>
<div class="IND"><!-- End Header --><a id="CBADHGHH" name="CBADHGHH"></a><a id="NTMTS003" name="NTMTS003"></a>
<h1 class="chapter"><span class="secnum">3</span> Managing Recovery Scenarios</h1>
<p>This chapter describes how to create and schedule <a href="glossary.htm#CBAIJAFH"><span class="xrefglossterm">Microsoft Transaction Server</span></a>-related Oracle transaction recovery.</p>
<p>This chapter contains these topics:</p>
<ul>
<li>
<p><a href="#i1007073">Microsoft Transaction Server Configuration Requirements</a></p>
</li>
<li>
<p><a href="#i1007174">Microsoft Transaction Server Transaction Recovery Overview</a></p>
</li>
<li>
<p><a href="#i1007223">Scheduling Automatic Microsoft Transaction Server Transaction Recovery</a></p>
</li>
<li>
<p><a href="#i1007501">Viewing Microsoft Transaction Server In-Doubt Transactions</a></p>
</li>
<li>
<p><a href="#i1007525">Modifying Registry Values for Oracle Fail Safe Configurations</a></p>
</li>
</ul>
<a id="i1007073" name="i1007073"></a><a id="NTMTS134" name="NTMTS134"></a>
<div class="sect1">
<h2 class="sect1">Microsoft Transaction Server Configuration Requirements<a id="sthref59" name="sthref59"></a><a id="sthref60" name="sthref60"></a><a id="sthref61" name="sthref61"></a><a id="sthref62" name="sthref62"></a></h2>
<a id="i1007093" name="i1007093"></a>
<p>You must configure the Microsoft Transaction Server and Oracle Database environments after installing or migrating <a href="glossary.htm#CBAJACIF"><span class="xrefglossterm">Oracle Services for Microsoft Transaction Server (OraMTS)</span></a>.</p>
<p>Configuration is not required on the Windows computer if a Microsoft Transaction Server is installed on a computer.</p>
<p>To configure the Microsoft Transaction Server, perform the following tasks on the computer where the Oracle Database is installed:</p>
<ol>
<li>
<p>Run the <code>oramtsadmin.sql</code> script against the database to create the Microsoft Transaction Server administrative user account (the default username is <code>mtssys</code>).</p>
</li>
<li>
<p>Schedule automatic transaction recovery.</p>
<p>See <a href="#i1007223">"Scheduling Automatic Microsoft Transaction Server Transaction Recovery"</a></p>
</li>
<li>
<p>If you have an Oracle Fail Safe configuration, modify the registry values before or after running the <code>oramtsadmin.sql</code> script.</p>
<p>See <a href="#i1007525">"Modifying Registry Values for Oracle Fail Safe Configurations"</a>.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i1007174" name="i1007174"></a><a id="NTMTS135" name="NTMTS135"></a>
<div class="sect1">
<h2 class="sect1">Microsoft Transaction Server <a id="sthref63" name="sthref63"></a><a id="sthref64" name="sthref64"></a><a id="sthref65" name="sthref65"></a><a id="sthref66" name="sthref66"></a><a id="sthref67" name="sthref67"></a>Transaction Recovery Overview</h2>
<a id="i1007184" name="i1007184"></a>
<p>Distributed transaction capabilities are required to use Microsoft Transaction Server with Oracle database. Microsoft Transaction Server-related Oracle transactions become in-doubt transactions when any of the following fail:</p>
<ul>
<li>
<p>Microsoft Transaction Server application</p>
</li>
<li>
<p>Network</p>
</li>
<li>
<p><a href="glossary.htm#i996748"><span class="xrefglossterm">Microsoft Distributed Transaction Coordinator (MS DTC)</span></a></p>
</li>
</ul>
<p>An <a href="glossary.htm#i996808">Oracle MTS Recovery Service</a> resolves in-doubt transactions on the computer that started the failed transaction. An Oracle MTS Recovery Service is automatically installed with Oracle Services For Microsoft Transaction Server. Only one Oracle MTS Recovery Service can be installed for each computer. A scheduled recovery job on each Microsoft Transaction Server-enabled database permits the Oracle MTS Recovery Service to resolve in-doubt transactions.</p>
<p>The Oracle MTS Recovery Service resolves an in-doubt Microsoft Transaction Server transaction in the following order:</p>
<ol>
<li>
<p>The DBMS recovery job detects an in-doubt MTS-related transaction.</p>
</li>
<li>
<p>The DBMS recovery job extracts the recovery service's endpoint address from the XID of the in-doubt transaction and requests the recovery service for the outcome of the MTS/MS DTC transaction.</p>
</li>
<li>
<p>The recovery service requests its MS DTC for transaction outcome.</p>
</li>
<li>
<p>The recovery service reports transaction outcome to the DBMS job process.</p>
</li>
<li>
<p>The DBMS recovery job commits or terminates the in-doubt transaction.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i1007223" name="i1007223"></a><a id="NTMTS136" name="NTMTS136"></a>
<div class="sect1">
<h2 class="sect1"><a id="sthref68" name="sthref68"></a><a id="sthref69" name="sthref69"></a><a id="sthref70" name="sthref70"></a>Scheduling Automatic Microsoft Transaction Server Transaction Recovery</h2>
<p>OraMTS uses server-based recovery to resolve in-doubt transactions originated by MSDTC. To do this, the OraMTS administrator must be able to access the Windows middle-tier node through <code>UTL_HTTP</code>. <code>oramtsadmin.sql</code> grants execute privileges on <code>UTL_HTTP</code> to the OraMTS administrator, as shown in <a href="#BGBJHACB">"Configuring Automatic Transaction Recovery"</a></p>
<div class="infoboxnote">
<p class="notep1">Note:</p>
Starting with Oracle version 11<span class="italic">g</span>, the DBA needs to create an access control list (ACL) as shown in <a href="#BGBCICFA">"Creating an Access Control List (ACL)"</a>.</div>
<a id="BGBCICFA" name="BGBCICFA"></a>
<div class="sect2">
<h3 class="sect2">Creating an Access Control List (ACL)</h3>
<p>For Oracle database version 11<span class="italic">g</span> and later, the DBA must create an access control list (ACL) that grants the OraMTS administrator the privilege to make out-bound HTTP connections. <a href="#BGBJBGBF">Example 3-1</a> demonstrates this:</p>
<div class="example"><a id="BGBJBGBF" name="BGBJBGBF"></a>
<p class="titleinexample">Example 3-1 Creating an ACL List and Adding OraMTS Administrator to it</p>
<pre xml:space="preserve" class="oac_no_warn">BEGIN
   -- Create the new ACL, naming it "OraMTSadmin.xml", with a description.
   -- This provides the OraMTS administrative user e.g. MTSADMIN user FOO
   -- the privilege to connect
   DBMS_NETWORK_ACL_ADMIN.CREATE_ACL('OraMTSadmin.xml',
                                    'Allow usage to the UTL network packages',
                                    'FOO', TRUE, 'connect');
   -- Now grant privilege to resolve DNS names to the OraMTS administrative user
   DBMS_NETWORK_ACL_ADMIN.ADD_PRIVILEGE('OraMTSadmin.xml' ,
                                        'FOO', TRUE,'resolve');
  -- Specify which hosts this ACL applies to, in this case we are allowing
  -- access to all hosts. if one knew the list of all Windows middle-tier,
  -- these could be added one by one.
   DBMS_NETWORK_ACL_ADMIN.ASSIGN_ACL('OraMTSadmin.xml','*');
 END;
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="BGBJHACB" name="BGBJHACB"></a>
<div class="sect2">
<h3 class="sect2">Configuring Automatic Transaction Recovery</h3>
<p>Automatic transaction recovery is performed by scheduling a database job. A database job for in-doubt transactions must be scheduled for each database participating in Microsoft Transaction Server transactions.</p>
<p>Transaction recovery is configured by running the <code>oramtsadmin.sql</code> script, which triggers <code><a id="sthref71" name="sthref71"></a>utl_oramts.sql</code> and <code><a id="sthref72" name="sthref72"></a>prvtoramts.plb</code> scripts to create the PL/SQL package <code>utl_oramts</code>. The database view <code>oramts_2pc_pending</code> is also created to show in-doubt transactions related to Microsoft Transaction Server transactions.</p>
<p>The <code>oramtsadmin.sql</code> script:</p>
<ul>
<li>
<p>Creates the Microsoft Transaction Server administrator user account.</p>
</li>
<li>
<p>Automatically schedules database jobs for transaction recovery every one minute.</p>
<p>When the database job is run, it checks for unresolved global transactions in the database that are related to Microsoft Transaction Server. Information in the <a href="glossary.htm#CBAHGIEA"><span class="xrefglossterm">transaction identifiers (XIDs)</span></a> of the in-doubt transactions identifies the computer on which the transaction was started. The Oracle MTS Recovery Service on that computer resolves the transaction.</p>
</li>
<li>
<p>Schedules post-recovery cleanup every half hour.</p>
</li>
</ul>
<p>Schedule automatic transaction recovery in the database by performing these tasks:</p>
<ul>
<li>
<p><a href="#i1007268">Setting and Starting Up Database Job-Queue Processes</a></p>
</li>
<li>
<p><a href="#i1007312">Creating and Scheduling Automatic Transaction Recovery</a></p>
</li>
</ul>
<a id="i1007268" name="i1007268"></a><a id="NTMTS137" name="NTMTS137"></a>
<div class="sect3">
<h4 class="sect3">Setting and Starting Up <a id="sthref73" name="sthref73"></a><a id="sthref74" name="sthref74"></a><a id="sthref75" name="sthref75"></a>Database Job-Queue Processes</h4>
<p>The <code>JOB_QUEUE_PROCESSES</code> initialization parameter specifies the number of job queue processes started in an instance.</p>
<p>To set and start up job-queue processes:</p>
<ol>
<li>
<p>Ensure that you have <code>SYSDBA</code> privileges.</p>
</li>
<li>
<p>Go to the computer on which the Oracle Database is installed.</p>
</li>
<li>
<p>Start SQL*Plus:</p>
<pre xml:space="preserve" class="oac_no_warn">C:\&gt; sqlplus /NOLOG
</pre></li>
<li>
<p>Connect to the database as <code>SYSDBA</code>:</p>
<pre xml:space="preserve" class="oac_no_warn">SQL&gt; CONNECT / AS SYSDBA
</pre></li>
<li>
<p>Set the <code>JOB_QUEUE_PROCESSES</code> initialization parameter:</p>
<pre xml:space="preserve" class="oac_no_warn"><a id="sthref76" name="sthref76"></a><a id="sthref77" name="sthref77"></a><a id="sthref78" name="sthref78"></a><a id="sthref79" name="sthref79"></a>JOB_QUEUE_PROCESSES = 1
</pre>
<p>The default value for this parameter is <code>0</code>. Set this parameter to a value greater than <code>1</code> if there are many destinations to which to propagate the messages.</p>
</li>
<li>
<p>Shut down the Oracle Database:</p>
<pre xml:space="preserve" class="oac_no_warn">SQL&gt; SHUTDOWN
</pre></li>
<li>
<p>Restart the Oracle Database:</p>
<pre xml:space="preserve" class="oac_no_warn">SQL&gt; STARTUP
</pre></li>
<li>
<p>Exit SQL*Plus:</p>
<a id="i1007310" name="i1007310"></a>
<pre xml:space="preserve" class="oac_no_warn">SQL&gt; EXIT
</pre></li>
</ol>
</div>
<!-- class="sect3" -->
<a id="i1007312" name="i1007312"></a><a id="NTMTS138" name="NTMTS138"></a>
<div class="sect3">
<h4 class="sect3">Creating and Scheduling Automatic Transaction Recovery <a id="sthref80" name="sthref80"></a><a id="sthref81" name="sthref81"></a><a id="sthref82" name="sthref82"></a><a id="sthref83" name="sthref83"></a></h4>
<p>The <code>oramtsadmin.sql</code> script creates the Microsoft Transaction Server administrator user account with the default username <code>mtssys</code>. The Microsoft Transaction Server transaction recovery jobs run under the administrator user account.</p>
<p>The <code>oramtsadmin.sql</code> script runs the <code><a id="sthref84" name="sthref84"></a><a id="sthref85" name="sthref85"></a>utl_oramts.sql</code> script to grant the following <a id="sthref86" name="sthref86"></a>privileges and roles to the administrator user account:</p>
<ul>
<li>
<p><a id="sthref87" name="sthref87"></a><a id="sthref88" name="sthref88"></a><code>CREATE SESSION</code> role</p>
</li>
<li>
<p><a id="sthref89" name="sthref89"></a><a id="sthref90" name="sthref90"></a><code>SELECT_CATALOG_ROLE</code> role</p>
</li>
<li>
<p><a id="sthref91" name="sthref91"></a><a id="sthref92" name="sthref92"></a><code>FORCE_ANY_TRANSACTION</code> privilege</p>
</li>
<li>
<p><a id="sthref93" name="sthref93"></a><a id="sthref94" name="sthref94"></a><code>DBMS_JOBS</code> package, on which <code>EXECUTE</code> privileges are granted</p>
</li>
<li>
<p><a id="sthref95" name="sthref95"></a><a id="sthref96" name="sthref96"></a><code>DBMS_TRANSACTION</code> package, on which <code>EXECUTE</code> privileges are granted</p>
</li>
</ul>
<p>To create and schedule automatic transaction recovery:</p>
<ol>
<li>
<p>Ensure that you have <code>SYSDBA</code> privileges.</p>
</li>
<li>
<p>Log on to the computer where the Oracle Database is installed.</p>
</li>
<li>
<p>Start SQL*Plus:</p>
<pre xml:space="preserve" class="oac_no_warn">C:\&gt; sqlplus /NOLOG 
</pre></li>
<li>
<p>Connect to the database as <code>SYSDBA</code>:</p>
<pre xml:space="preserve" class="oac_no_warn">SQL&gt; CONNECT / AS SYSDBA
</pre></li>
<li><a id="i1007354" name="i1007354"></a>
<p>Run the <code>oramtsadmin.sql</code> script:</p>
<pre xml:space="preserve" class="oac_no_warn">SQL&gt; @<span class="italic">ORACLE_BASE</span>\<span class="italic">ORACLE_HOME</span>\oramts\admin\oramtsadmin.sql;<a id="sthref97" name="sthref97"></a><a id="sthref98" name="sthref98"></a><a id="sthref99" name="sthref99"></a>
</pre>
<p>You are prompted for the Microsoft Transaction Server administrator username and password. You can accept the default username of <code>mtssys</code> and password of <code>mtssys</code>, or change them.</p>
</li>
<li>
<p>If you did change the password in step <a href="#i1007354">5</a>, you can change it using this script:<a id="sthref100" name="sthref100"></a><a id="sthref101" name="sthref101"></a></p>
<pre xml:space="preserve" class="oac_no_warn">SQL&gt; ALTER USER <span class="italic">USERNAME</span> IDENTIFIED BY <span class="italic">new_password</span>;
</pre>
<p>To change the username after completing this task, drop the user, rerun the <code>oramtsadmin.sql</code> script, and specify a different username when prompted.</p>
</li>
<li><a id="i1007383" name="i1007383"></a>
<p>Exit SQL*Plus:</p>
<pre xml:space="preserve" class="oac_no_warn">SQL&gt; EXIT
</pre></li>
</ol>
<p>A single PL/SQL package, <code><a id="sthref102" name="sthref102"></a><a id="sthref103" name="sthref103"></a>utl_oramts</code>, is created in the Microsoft Transaction Server administrator's schema. <code>utl_oramts</code> exposes these public procedures and creates this view:</p>
<ul>
<li>
<p><a href="#i1007396">utl_oramts.show_indoubt Procedure</a></p>
</li>
<li>
<p><a href="#i1007434">utl_oramts.recover_automatic Procedure</a></p>
</li>
<li>
<p><a href="#i1007453">utl_oramts.forget_RMs Procedure</a></p>
</li>
<li>
<p><a href="#i1007463">oramts_2pc_pending View</a></p>
</li>
</ul>
<a id="i1007396" name="i1007396"></a><a id="NTMTS139" name="NTMTS139"></a>
<div class="sect4">
<h5 class="sect4">utl_oramts.show_indoubt <a id="sthref104" name="sthref104"></a><a id="sthref105" name="sthref105"></a>Procedure</h5>
<p>Use this procedure to view Microsoft Transaction Server in-doubt transactions in the database. This procedure uses the <code>dbms_output</code> package to display results.</p>
<a id="NTMTS140" name="NTMTS140"></a>
<p><span class="subhead3">Description&nbsp;</span>This procedure requires <code>SERVEROUTPUT</code> set to <code>ON</code>.</p>
<pre xml:space="preserve" class="oac_no_warn">SQL&gt; SET SERVEROUTPUT ON

SQL&gt; EXECUTE utl_oramts.show_indoubt;
</pre>
<p>The following information appears:</p>
<pre xml:space="preserve" class="oac_no_warn">=========================================================
currently indoubt transactions
=========================================================
formatid        : 21255235
gtrid                   : C2229A505904974D81FB7316B147325900000000
bqual           : 5BAB6A6B55CD294AA20335839110829C0100000000901944700050
local txid      : 142.11.202
tx state                   : prepared
protocol        : HTTP
endpoint        : middletier-1@foo.com:2030
=========================================================
formatid        : 21255235
gtrid                   : 259DF9C8DFC5574F8876F0DF4E15CCAD00000000
bqual           : 2C8DCED5B9816244BA2B73CC013EEB870100000000901944700050
local txid      : 2.18.185
tx state        : prepared
protocol        : HTTP
endpoint        : middletier-2@foo.com:2030
</pre></div>
<!-- class="sect4" -->
<a id="i1007434" name="i1007434"></a><a id="NTMTS141" name="NTMTS141"></a>
<div class="sect4">
<h5 class="sect4">utl_oramts.recover_automatic<a id="sthref106" name="sthref106"></a><a id="sthref107" name="sthref107"></a> Procedure</h5>
<p>This procedure is run by the transaction recovery job. An automatic database job is scheduled for <code>utl_oramts.recover_automatic</code>. When the job is run, it checks for unresolved global transactions in the database that are related to Microsoft Transaction Server. Information in the XIDs of the in-doubt transactions identifies the computer on which the transaction started. The Oracle MTS Recovery Service is contacted and resolves the transactions.</p>
</div>
<!-- class="sect4" -->
<a id="i1007453" name="i1007453"></a><a id="NTMTS142" name="NTMTS142"></a>
<div class="sect4">
<h5 class="sect4">utl_oramts.forget_RMs <a id="sthref108" name="sthref108"></a><a id="sthref109" name="sthref109"></a>Procedure</h5>
<p>Use this procedure to request the transaction manager (MS DTC) to forget resolved transactions. This procedure is run by the post-recovery cleanup job.</p>
</div>
<!-- class="sect4" -->
<a id="i1007463" name="i1007463"></a><a id="NTMTS143" name="NTMTS143"></a>
<div class="sect4">
<h5 class="sect4">oramts_2pc_pending View<a id="sthref110" name="sthref110"></a><a id="sthref111" name="sthref111"></a></h5>
<p>The view <code>oramts_2pc_pending</code> is created by executing <code>oramtsadmin.sql</code>. <code>oramts_2pc_pending</code> shows in-doubt transactions in the database. This view consists of the following columns:</p>
<a id="NTMTS144" name="NTMTS144"></a><a id="sthref112" name="sthref112"></a>
<p><span class="subhead3">Formatid &nbsp;</span>This is the <code>formatid</code> of the global transaction in the database.</p>
<a id="NTMTS145" name="NTMTS145"></a><a id="sthref113" name="sthref113"></a>
<p><span class="subhead3">global_transaction_id &nbsp;</span>This is the transaction identifier of the Oracle global transaction corresponding to the Microsoft Transaction Server transaction. In fact, this is the globally unique identifier (GUID) of the Microsoft Transaction Server transaction.</p>
<a id="NTMTS146" name="NTMTS146"></a><a id="sthref114" name="sthref114"></a>
<p><span class="subhead3">branch_id&nbsp;</span>This shows the branch identifier of the Oracle transaction. A single Microsoft Transaction Server transaction can have multiple Oracle global transactions. This depends on the number of Microsoft Transaction Server/COM+ components that span the same Microsoft Transaction Server transaction. All these transactions have the small global transaction identifier, but different branch identifiers.</p>
<a id="NTMTS147" name="NTMTS147"></a><a id="sthref115" name="sthref115"></a>
<p><span class="subhead3">local_tx_id&nbsp;</span>A local Oracle transaction corresponds to each Microsoft Transaction Server transaction. This column shows the identifier corresponding to this local transaction.</p>
<a id="NTMTS148" name="NTMTS148"></a><a id="sthref116" name="sthref116"></a>
<p><span class="subhead3">state&nbsp;</span>This shows the state of the transaction: pending, heuristically committed, heuristically terminated, and so on.</p>
<a id="NTMTS149" name="NTMTS149"></a><a id="sthref117" name="sthref117"></a>
<p><span class="subhead3">protocol&nbsp;</span>This is the protocol that the transaction recovery job in the database uses to communicate with the Oracle MTS Recovery Service.</p>
<a id="NTMTS150" name="NTMTS150"></a><a id="sthref118" name="sthref118"></a>
<p><span class="subhead3">endpoint &nbsp;</span>This is the endpoint of the Windows computer on which the Microsoft Transaction Server transaction originated. For HTTP connections, this translates to a hostname and port number.</p>
</div>
<!-- class="sect4" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1007501" name="i1007501"></a><a id="NTMTS151" name="NTMTS151"></a>
<div class="sect1">
<h2 class="sect1"><a id="sthref119" name="sthref119"></a><a id="sthref120" name="sthref120"></a><a id="sthref121" name="sthref121"></a>Viewing Microsoft Transaction Server In-Doubt Transactions</h2>
<p>To view Microsoft Transaction Server&#x2013;related in-doubt transactions in the database, use SQL*Plus to query the view <code>oramts_2pc_pending</code>:</p>
<ol>
<li>
<p>Start SQL*Plus with the Microsoft Transaction Server administrator user account:</p>
<pre xml:space="preserve" class="oac_no_warn">C:\&gt; sqlplus <span class="italic">mtsadmin_user</span><span class="italic">/ mtsadmin_password</span>
</pre></li>
<li>
<p>Enter the following command:</p>
<pre xml:space="preserve" class="oac_no_warn">SQL&gt; SELECT * FROM oramts_2pc_pending;
</pre>
<p>This displays the computer on which the in-doubt transaction originated.</p>
</li>
</ol>
</div>
<!-- class="sect1" -->
<a id="i1007525" name="i1007525"></a><a id="NTMTS152" name="NTMTS152"></a>
<div class="sect1">
<h2 class="sect1"><a id="sthref122" name="sthref122"></a><a id="sthref123" name="sthref123"></a>Modifying <a id="sthref124" name="sthref124"></a>Registry Values for Oracle Fail Safe Configurations</h2>
<p>In typical <a id="sthref125" name="sthref125"></a>configurations, the MS DTC and Oracle MTS Recovery Service run on the same computer. This ensures that the required information for transaction recovery is available to the Oracle-Microsoft Transaction Server integration layer.</p>
<p>In configurations where the Microsoft Transaction Server application is part of a Windows cluster (for example, the application can fail over to another node or host in the cluster), the <a id="sthref126" name="sthref126"></a>MS DTC runs as a cluster-wide resource. All cluster nodes use a single instance of the MS DTC running on any cluster node.</p>
<p>If you have an Oracle Fail Safe configuration, make sure the following registry information is replicated on all nodes in the cluster participating in Microsoft Transaction Server transactions:</p>
<p>To modify registry values for Oracle Fail Safe configurations:</p>
<ol>
<li>
<p>Go to the computer on which the MS DTC and Oracle MTS Recovery Service are installed.</p>
</li>
<li>
<p>Start the registry from the command prompt:</p>
<pre xml:space="preserve" class="oac_no_warn">C:\&gt; regedt32
</pre>
<p>The Registry Editor window appears.</p>
</li>
<li>
<p>Go to <code>HKEY_LOCAL_MACHINE</code>\<code>Software</code>\<code>Oracle</code>\<code>OracleMTSRecoveryService</code>.</p>
</li>
<li>
<p>Copy the registry information appearing here to all nodes in the cluster.</p>
</li>
<li>
<p>Reboot the computer on which you added the key.</p>
</li>
</ol>
</div>
<!-- class="sect1" --></div>
<!-- class="ind" -->
<div class="footer">
<hr />
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<col width="33%" />
<col width="*" />
<col width="33%" />
<tr>
<td align="left">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="98">
<tr>
<td align="center" valign="top"><a href="install.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td align="center" valign="top"><a href="prog.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td style="font-size: 90%" align="center" class="copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;1996, 2010,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td align="right">
<table class="icons oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="245">
<tr>
<td align="center" valign="top"><a href="../../index.htm"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td align="center" valign="top"><a href="../../nav/portal_booklist.htm"><img width="24" height="24" src="../../dcommon/gifs/booklist.gif" alt="Go to Book List" /><br />
<span class="icon">Book List</span></a></td>
<td align="center" valign="top"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td align="center" valign="top"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td align="center" valign="top"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
</div>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
